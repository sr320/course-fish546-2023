{
  "hash": "00ad27b7eee394d4c848cc63a7ba3f44",
  "result": {
    "markdown": "---\ntitle: \"NCBI Blast\"\nsubtitle: \"Taking a set of unknown sequence files and annotating them\"\n\nformat:\n  html:\n    code-fold: false\n    code-tools: true\n    code-copy: true\n    highlight-style: github\n    code-overflow: wrap\n---\n\n\nFor the first task you will take an unknown multi-fasta file and annotate it using blast. You are welcome to do this in terminal, Rstudio, or jupyter. My recommendation, and how I will demonstrate is using Rmarkdown. Once you have have your project structured, we will download software, databases, a fasta file and run the code.\n\n::: callout-important\n## Assignment\n\nAnnotate a provided fasta file with GO terms. Your code should be fully reproducible.\n:::\n\nIn your code directory create a file.\n\n`01-blast.Rmd`\n\n::: callout-tip\nRmarkdown is a good option as you can use markdown, add pictures and more!\n:::\n\n# Downloading software\n\nNCBI Blast Software is at\n\n<https://ftp.ncbi.nlm.nih.gov/blast/executables/blast+/LATEST/>\n\n::: callout-tip\nIt is best to decide on central location on computer where software will be downloaded.\n:::\n\n\n```{{bash}}\ncd /Applications/bioinfo/\ncurl -O https://ftp.ncbi.nlm.nih.gov/blast/executables/blast+/LATEST/ncbi-blast-2.13.0+-x64-macosx.tar.gz\ntar -xf ncbi-blast-2.13.0+-x64-macosx.tar.gz\n```\n\n```{{bash}}\nls /Applications/bioinfo/\n```\n\n```{{bash}}\n/Applications/bioinfo/ncbi-blast-2.13.0+/bin/blastx -h\n```\n\n# Make Blast Database\n\nsee <https://www.uniprot.org/downloads>\n\nhttps://ftp.uniprot.org/pub/databases/uniprot/current_release/knowledgebase/complete/uniprot_sprot.fasta.gz\n\n```{{bash}}\ncd ../data\ncurl -O https://ftp.uniprot.org/pub/databases/uniprot/current_release/knowledgebase/complete/uniprot_sprot.fasta.gz\nmv uniprot_sprot.fasta.gz uniprot_sprot_r2023_01.fasta.gz\ngunzip -k uniprot_sprot_r2023_01.fasta.gz\nls ../data\n```\n\n```{{bash}}\n/Applications/bioinfo/ncbi-blast-2.13.0+/bin/makeblastdb \\\n-in ../data/uniprot_sprot_r2023_01.fasta \\\n-dbtype prot \\\n-out ../blastdb/uniprot_sprot_r2023_01\n```\n\n# Get the query sequence\n\n```{{bash}}\ncurl https://eagle.fish.washington.edu/cnidarian/Ab_4denovo_CLC6_a.fa \\\n-k \\\n> ../data/Ab_4denovo_CLC6_a.fa\n```\n\n\n::: {.cell}\n\n```{.bash .cell-code}\nhead ../data/Ab_4denovo_CLC6_a.fa\necho \"How many sequences are there?\"\ngrep -c \">\" ../data/Ab_4denovo_CLC6_a.fa\n```\n\n\n::: {.cell-output .cell-output-stdout}\n```\n>solid0078_20110412_FRAG_BC_WHITE_WHITE_F3_QV_SE_trimmed_contig_1\nACACCCCACCCCAACGCACCCTCACCCCCACCCCAACAATCCATGATTGAATACTTCATC\nTATCCAAGACAAACTCCTCCTACAATCCATGATAGAATTCCTCCAAAAATAATTTCACAC\nTGAAACTCCGGTATCCGAGTTATTTTGTTCCCAGTAAAATGGCATCAACAAAAGTAGGTC\nTGGATTAACGAACCAATGTTGCTGCGTAATATCCCATTGACATATCTTGTCGATTCCTAC\nCAGGATCCGGACTGACGAGATTTCACTGTACGTTTATGCAAGTCATTTCCATATATAAAA\nTTGGATCTTATTTGCACAGTTAAATGTCTCTATGCTTATTTATAAATCAATGCCCGTAAG\nCTCCTAATATTTCTCTTTTCGTCCGACGAGCAAACAGTGAGTTTACTGTGGCCTTCAGCA\nAAAGTATTGATGTTGTAAATCTCAGTTGTGATTGAACAATTTGCCTCACTAGAAGTAGCC\nTTC\nHow many sequences are there?\n5490\n```\n:::\n:::\n\n\n# Run Blast\n\n```{{bash}}\n/Applications/bioinfo/ncbi-blast-2.13.0+/bin/blastx \\\n-query ../data/Ab_4denovo_CLC6_a.fa \\\n-db ../blastdb/uniprot_sprot_r2023_01 \\\n-out ../output/Ab_4-uniprot_blastx.tab \\\n-evalue 1E-20 \\\n-num_threads 20 \\\n-max_target_seqs 1 \\\n-outfmt 6\n```\n\n\n::: {.cell}\n\n```{.bash .cell-code}\nhead -2 ../output/Ab_4-uniprot_blastx.tab\nwc -l ../output/Ab_4-uniprot_blastx.tab\n```\n\n\n::: {.cell-output .cell-output-stdout}\n```\nsolid0078_20110412_FRAG_BC_WHITE_WHITE_F3_QV_SE_trimmed_contig_3\tsp|O42248|GBLP_DANRE\t82.456\t171\t30\t0\t1\t513\t35\t205\t2.81e-103\t301\nsolid0078_20110412_FRAG_BC_WHITE_WHITE_F3_QV_SE_trimmed_contig_5\tsp|Q08013|SSRG_RAT\t75.385\t65\t16\t0\t3\t197\t121\t185\t1.40e-28\t104\n     765 ../output/Ab_4-uniprot_blastx.tab\n```\n:::\n:::\n\n\nNeed to convert `sp|Q08013|SSRG_RAT` to get accession number out.\n\n# Getting more information\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../img/uniprot.png){fig-align='center' width=70%}\n:::\n:::\n\n\nhttps://www.uniprot.org/uniprotkb\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](../img/uniprot-api.png){fig-align='center' width=70%}\n:::\n:::\n\n\n```\nhttps://rest.uniprot.org/uniprotkb/stream?compressed=true&fields=accession%2Creviewed%2Cid%2Cprotein_name%2Cgene_names%2Corganism_name%2Clength%2Cgo_f%2Cgo%2Cgo_p%2Cgo_c%2Cgo_id%2Ccc_interaction%2Cec%2Cxref_reactome%2Cxref_unipathway%2Cxref_interpro&format=tsv&query=%28%2A%29%20AND%20%28reviewed%3Atrue%29\n```\n\n``` {{bash}}\ncurl -O \"Accept: text/plain; format=tsv\" \"https://rest.uniprot.org/uniprotkb/search?query=reviewed:true+AND+organism_id:9606\"\n```\n\n``` {{bash}}\ncurl -O -H \"Accept: text/plain; format=tsv\" \"https://rest.uniprot.org/uniprotkb/stream?compressed=true&fields=accession%2Creviewed%2Cid%2Cprotein_name%2Cgene_names%2Corganism_name%2Clength%2Cgo_f%2Cgo%2Cgo_p%2Cgo_c%2Cgo_id%2Ccc_interaction%2Cec%2Cxref_reactome%2Cxref_unipathway%2Cxref_interpro&format=tsv&query=%28%2A%29%20AND%20%28reviewed%3Atrue%29\"\n```\n\n## Joining blast table with annotation table\n\nAt this point we have a blast output table and annotation table both with a Uniprot accession number. Thus we can join the two tables and be able to get more functional information about thet genes.\n\n```{{bash}}\nhead -2 ../output/Ab_4-uniprot_blastx.tab\nwc -l ../output/Ab_4-uniprot_blastx.tab\n```\n\n```{{bash}}\ntr '|' '\\t' < ../output/Ab_4-uniprot_blastx.tab | head -2\n```\n\n```{{bash}}\ntr '|' '\\t' < ../output/Ab_4-uniprot_blastx.tab \\\n> ../output/Ab_4-uniprot_blastx_sep.tab\n```\n\n```{{bash}}\nhead -2 ../data/uniprot_table_r2023_01.tab\nwc -l ../data/uniprot_table_r2023_01.tab\n```\n\n```{{r}}\nlibrary(tidyverse)\nlibrary(\"kableExtra\")\n```\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbltabl <- read.csv(\"../output/Ab_4-uniprot_blastx_sep.tab\", sep = '\\t', header = FALSE)\n```\n:::\n\n::: {.cell hash='01-blast_cache/html/unnamed-chunk-4_cbfd4293671f08d3362759ade754e634'}\n\n```{.r .cell-code}\nspgo <- read.csv(\"../data/uniprot_table_r2023_01.tab\", sep = '\\t', header = TRUE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(spgo)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n'data.frame':\t569213 obs. of  17 variables:\n $ Entry                             : chr  \"A0A023I7E1\" \"A0A024B7W1\" \"A0A024SC78\" \"A0A024SH76\" ...\n $ Reviewed                          : chr  \"reviewed\" \"reviewed\" \"reviewed\" \"reviewed\" ...\n $ Entry.Name                        : chr  \"ENG1_RHIMI\" \"POLG_ZIKVF\" \"CUTI1_HYPJR\" \"GUX2_HYPJR\" ...\n $ Protein.names                     : chr  \"Glucan endo-1,3-beta-D-glucosidase 1 (Endo-1,3-beta-glucanase 1) (EC 3.2.1.39) (Laminarinase) (RmLam81A)\" \"Genome polyprotein [Cleaved into: Capsid protein C (Capsid protein) (Core protein); Protein prM (Precursor memb\"| __truncated__ \"Cutinase (EC 3.1.1.74)\" \"Exoglucanase 2 (EC 3.2.1.91) (1,4-beta-cellobiohydrolase) (Cellobiohydrolase 6A) (Cel6A) (Exocellobiohydrolase \"| __truncated__ ...\n $ Gene.Names                        : chr  \"ENG1 LAM81A\" \"\" \"M419DRAFT_76732\" \"cbh2 M419DRAFT_122470\" ...\n $ Organism                          : chr  \"Rhizomucor miehei\" \"Zika virus (isolate ZIKV/Human/French Polynesia/10087PF/2013) (ZIKV)\" \"Hypocrea jecorina (strain ATCC 56765 / BCRC 32924 / NRRL 11460 / Rut C-30) (Trichoderma reesei)\" \"Hypocrea jecorina (strain ATCC 56765 / BCRC 32924 / NRRL 11460 / Rut C-30) (Trichoderma reesei)\" ...\n $ Length                            : int  796 3423 248 471 478 693 333 742 2442 455 ...\n $ Gene.Ontology..molecular.function.: chr  \"glucan endo-1,3-beta-D-glucosidase activity [GO:0042973]; glucan endo-1,3-beta-glucanase activity, C-3 substitu\"| __truncated__ \"4 iron, 4 sulfur cluster binding [GO:0051539]; ATP binding [GO:0005524]; ATP hydrolysis activity [GO:0016887]; \"| __truncated__ \"cutinase activity [GO:0050525]\" \"cellulose 1,4-beta-cellobiosidase activity [GO:0016162]; cellulose binding [GO:0030248]\" ...\n $ Gene.Ontology..GO.                : chr  \"extracellular region [GO:0005576]; glucan endo-1,3-beta-D-glucosidase activity [GO:0042973]; glucan endo-1,3-be\"| __truncated__ \"extracellular region [GO:0005576]; host cell endoplasmic reticulum membrane [GO:0044167]; host cell nucleus [GO\"| __truncated__ \"extracellular region [GO:0005576]; cutinase activity [GO:0050525]\" \"extracellular region [GO:0005576]; cellulose 1,4-beta-cellobiosidase activity [GO:0016162]; cellulose binding [\"| __truncated__ ...\n $ Gene.Ontology..biological.process.: chr  \"cell wall organization [GO:0071555]; polysaccharide catabolic process [GO:0000272]\" \"clathrin-dependent endocytosis of virus by host cell [GO:0075512]; fusion of virus membrane with host endosome \"| __truncated__ \"\" \"cellulose catabolic process [GO:0030245]\" ...\n $ Gene.Ontology..cellular.component.: chr  \"extracellular region [GO:0005576]\" \"extracellular region [GO:0005576]; host cell endoplasmic reticulum membrane [GO:0044167]; host cell nucleus [GO\"| __truncated__ \"extracellular region [GO:0005576]\" \"extracellular region [GO:0005576]\" ...\n $ Gene.Ontology.IDs                 : chr  \"GO:0000272; GO:0005576; GO:0042973; GO:0052861; GO:0052862; GO:0071555\" \"GO:0003724; GO:0003725; GO:0003968; GO:0004252; GO:0004482; GO:0004483; GO:0005198; GO:0005524; GO:0005525; GO:\"| __truncated__ \"GO:0005576; GO:0050525\" \"GO:0005576; GO:0016162; GO:0030245; GO:0030248\" ...\n $ Interacts.with                    : chr  \"\" \"\" \"\" \"\" ...\n $ EC.number                         : chr  \"3.2.1.39\" \"2.1.1.56; 2.1.1.57; 2.7.7.48; 3.4.21.91; 3.6.1.15; 3.6.4.13\" \"3.1.1.74\" \"3.2.1.91\" ...\n $ Reactome                          : chr  \"\" \"\" \"\" \"\" ...\n $ UniPathway                        : chr  \"\" \"\" \"\" \"\" ...\n $ InterPro                          : chr  \"IPR005200;IPR040720;IPR040451;\" \"IPR011492;IPR043502;IPR000069;IPR038302;IPR013755;IPR001122;IPR037172;IPR027287;IPR026470;IPR038345;IPR001157;I\"| __truncated__ \"IPR029058;IPR000675;IPR043580;IPR043579;IPR011150;\" \"IPR016288;IPR036434;IPR035971;IPR000254;IPR001524;\" ...\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nkbl(\nhead(\n  left_join(bltabl, spgo,  by = c(\"V3\" = \"Entry\")) %>%\n  select(V1, V3, V13, Protein.names, Organism, Gene.Ontology..biological.process., Gene.Ontology.IDs) %>% mutate(V1 = str_replace_all(V1, \n            pattern = \"solid0078_20110412_FRAG_BC_WHITE_WHITE_F3_QV_SE_trimmed\", replacement = \"Ab\"))\n)\n) %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> V1 </th>\n   <th style=\"text-align:left;\"> V3 </th>\n   <th style=\"text-align:right;\"> V13 </th>\n   <th style=\"text-align:left;\"> Protein.names </th>\n   <th style=\"text-align:left;\"> Organism </th>\n   <th style=\"text-align:left;\"> Gene.Ontology..biological.process. </th>\n   <th style=\"text-align:left;\"> Gene.Ontology.IDs </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Ab_contig_3 </td>\n   <td style=\"text-align:left;\"> O42248 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> Guanine nucleotide-binding protein subunit beta-2-like 1 (Receptor of activated protein kinase C) (RACK) </td>\n   <td style=\"text-align:left;\"> Danio rerio (Zebrafish) (Brachydanio rerio) </td>\n   <td style=\"text-align:left;\"> angiogenesis [GO:0001525]; convergent extension involved in gastrulation [GO:0060027]; negative regulation of Wnt signaling pathway [GO:0030178]; positive regulation of gastrulation [GO:2000543]; positive regulation of protein phosphorylation [GO:0001934]; regulation of cell division [GO:0051302]; regulation of establishment of cell polarity [GO:2000114]; regulation of protein localization [GO:0032880]; rescue of stalled ribosome [GO:0072344] </td>\n   <td style=\"text-align:left;\"> GO:0001525; GO:0001934; GO:0005080; GO:0005634; GO:0005737; GO:0005829; GO:0005840; GO:0030178; GO:0032880; GO:0043022; GO:0045182; GO:0051302; GO:0060027; GO:0072344; GO:1990904; GO:2000114; GO:2000543 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Ab_contig_5 </td>\n   <td style=\"text-align:left;\"> Q08013 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> Translocon-associated protein subunit gamma (TRAP-gamma) (Signal sequence receptor subunit gamma) (SSR-gamma) </td>\n   <td style=\"text-align:left;\"> Rattus norvegicus (Rat) </td>\n   <td style=\"text-align:left;\"> SRP-dependent cotranslational protein targeting to membrane [GO:0006614] </td>\n   <td style=\"text-align:left;\"> GO:0005783; GO:0005784; GO:0006614 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Ab_contig_6 </td>\n   <td style=\"text-align:left;\"> P12234 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> Phosphate carrier protein, mitochondrial (Phosphate transport protein) (PTP) (Solute carrier family 25 member 3) </td>\n   <td style=\"text-align:left;\"> Bos taurus (Bovine) </td>\n   <td style=\"text-align:left;\"> mitochondrial phosphate ion transmembrane transport [GO:1990547]; phosphate ion transmembrane transport [GO:0035435] </td>\n   <td style=\"text-align:left;\"> GO:0005315; GO:0005739; GO:0005743; GO:0015293; GO:0035435; GO:0044877; GO:1990547 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Ab_contig_9 </td>\n   <td style=\"text-align:left;\"> Q41629 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> ADP,ATP carrier protein 1, mitochondrial (ADP/ATP translocase 1) (Adenine nucleotide translocator 1) (ANT 1) </td>\n   <td style=\"text-align:left;\"> Triticum aestivum (Wheat) </td>\n   <td style=\"text-align:left;\"> mitochondrial ADP transmembrane transport [GO:0140021]; mitochondrial ATP transmembrane transport [GO:1990544] </td>\n   <td style=\"text-align:left;\"> GO:0005471; GO:0005743; GO:0140021; GO:1990544 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Ab_contig_13 </td>\n   <td style=\"text-align:left;\"> Q32NG4 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> Glutamine amidotransferase-like class 1 domain-containing protein 1 (Parkinson disease 7 domain-containing protein 1) </td>\n   <td style=\"text-align:left;\"> Xenopus laevis (African clawed frog) </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> GO:0005576 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Ab_contig_23 </td>\n   <td style=\"text-align:left;\"> Q9GNE2 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:left;\"> 60S ribosomal protein L23 (AeRpL17A) (L17A) </td>\n   <td style=\"text-align:left;\"> Aedes aegypti (Yellowfever mosquito) (Culex aegypti) </td>\n   <td style=\"text-align:left;\"> translation [GO:0006412] </td>\n   <td style=\"text-align:left;\"> GO:0003735; GO:0005840; GO:0006412; GO:1990904 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n```{{r}}\nleft_join(bltabl, spgo,  by = c(\"V3\" = \"Entry\")) %>%\n  select(V1, V3, V13, Protein.names, Organism, Gene.Ontology..biological.process., Gene.Ontology.IDs) %>% mutate(V1 = str_replace_all(V1, \n            pattern = \"solid0078_20110412_FRAG_BC_WHITE_WHITE_F3_QV_SE_trimmed\", replacement = \"Ab\")) %>%\n  write_delim(\"../output/blast_annot_go.tab\", delim = '\\t')\n```\n\n```{{r}}\nannot_tab <- read.csv(\"../output/blast_annot_go.tab\", sep = '\\t', header = TRUE)\n```\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}